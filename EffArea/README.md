This folder contains the files needed to generate the effective area distribution. 

The main idea is that at each energy in your energy band, you calculate how many photons passed the selection criteria, divide this by the total number of photons generated, and multiply by the area where those photons came from.

# Files and Folders
Once you run cmake in your build directory, you get the following in this folder (excluding cmake and make files):
* GenCondorScripts.py: see [utils](../utils/README.md/#running-condor-jobs-to-generate-cones)
* CalcEffArea.py: See [EffArea](#calceffarea) section
* Commands.txt: Example shell commands integrated by GenCondorScripts.py. Implements no additional filtering of Compton Cones.
* CommandsSphere.txt:  Example shell commands integrated by GenCondorScripts.py. Implements no "Sphere" filter of Compton Cones (ie. a minimum seperation)
* CommandsUnique.txt:   Example shell commands integrated by GenCondorScripts.py. Implements no "Unique" filter of Compton Cones (ie. temporall adjacent scatters must occur in seperate optically isolated cells) 
* EffAreaPlt.py: Utility to plot .txt output of CalcEffArea.py
* SenseJob/: The folder that gets zipped up by GenCondorScripts.py

# Workflow
* The pipeline starts here since the rest of the sensitivity analysis is predicated on what the effective area response of GRAMS is.
* Create a output directory on a /data partition
* Look at the last example of GenCondorScipts.py (found [here](../utils/)) to get an example of how to set up the condor jobs
* condor_submit the generated .cmd file (test on a small batch first)
* Once everything is done, run CalcEffArea.py

# CalcEffArea
* This python script, given a directory containing the condor output generated by running GenCondorScripts.py, aggregates all the files and creates the effective area energy-dependent distribution in either .tsv or .root formats.

Required parameters are:
* start_folder: where the effective area condor root files are stored at
* base_name: the format that the condor root files follow
* Output: the output name of the effective area file. Needs to end in either .txt or .root

Additional parameters include:
* TOTALEVENTS: the number of events assigned to each batch file. This is NOT the same as the total number of events generated. Look at the .sh files generated by GenCondorScripts.py to see what this number is (It's just (total gamma rays produced across all jobs)/(Number of batches generated)). Defaults to 10,000
* TOTALBATCHES: the number of batches generated. Defaults to 10,000
* sphere_rad: the radius of the sphere where the particles where generated at. Defaults to 10.
* seperator: if you are saving as a raw text file, allows you to set the delimiter used. Defaults to "\t"

## Example Usage
Say that you effective area condor root files are stored at \${Input} and have a common format of EffArea_\${process}.root. This means that the base name used is "EffArea_". Also supposed that you used [Commands.txt](./Commands.txt) in this directory (ie. you used the default generating sphere).

Suppose that you generated 10,000 batches each with 20,000 gamma rays.

You want to save the output as a root file named "EffAreaAgg.root".

you would run the following command:
```
python ${Input} EffArea_ EffAreaAgg.root -b 10000 -n 20000
```

# Next Steps
Once you generate a .root file via CalcEffArea.py, you need to copy it over to "BackgroundCountHist" in Background and "SourceCountHist" in Source. You should then proceed to [Source](../Source/).